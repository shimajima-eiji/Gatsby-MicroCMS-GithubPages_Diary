{"componentChunkName":"component---src-templates-blog-post-js","path":"/complate_v1","result":{"pageContext":{"post":{"mainId":"complate_v1","title":"Gatsby+MicroCMS+Netlifyで遅かったアレコレを徹底検証！軽量化・高速化のためにやったこと全部話します","childConvertHtml":{"convertedHtml":"<p>Gatsbyに入門して一週間で出来たサイトですが、なかなかサマになったなぁ、と自己満足してます。<br>クオリティやアプローチはまだまだレガシーなんですが、サイトのタイトルの通り「インターネット老人おじさん」としているので、あんまりモダンなレイアウトにできなかった。<br>名前負けしました。<br></p><h2 id=\"h89c8822514\">タイトルが悪いのか？</h2><p>私だって本当はタイトルみたいなデザインとか作りたいんですが「○○ってBootstrapじゃね？」というよくわからない反骨心で採用しようとしない傾向にあります。<br>おかげで流行だけではなく思想までインターネット老人と化したわけですが、とりあえずベースになるブログはここまで出来たし、後は（高速化とか軽量化も）どこまで行っても趣味の世界だし、これ以上やりようがないので諦めます。<br>ぶっちゃけ<strong>MicroCMSを捨てたら爆速は維持できます</strong> し、こんなに苦労しなかったはずです。<br><a href=\"https://github.com/shimajima-eiji/Hosting/tree/Gatsby-Operaion-Nomuraya-Diary#%E3%81%AA%E3%81%9Cgatsby-transform-remark%E3%82%92%E6%8E%A1%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\" target=\"_blank\" rel=\"noopener noreferrer\">Githubリポジトリ</a> でも言及していますが、</p><ul><li>どこからでも</li><li>PCでもスマホでも</li><li>記事を書いたら即反映</li></ul><p>これを捻じ曲げると、昔運営していたGithubPages+Jekyllサイトのように非常にイラつかされる事になっていました。<br>GithubPagesを捨てたのも、ビルドが遅すぎて記事の修正確認がプレビューできなかった事にあります。<br></p><h2 id=\"h7d764a6d79\">静的サイトを運営した事があるから分かる、MocroCMSの良さ</h2><p>MicroCMSは画面プレビュー機能があるため、記事を更新してビルドするまで画面で確認ができない、という煩わしさを捨て去る事ができるのです。<br>これは、GatsbyJSのデフォルト機能ではできない事なので、とても捨てられません。<br>microCMSで書いてプレビューして、実際はGatsbyJSにマークダウンで置く手もなくはないですが、それだと二重管理になりますし、手間がかかります。<br>きっと途中で飽きて廃止するだろうな、という未来が今の時点で見えました。<br>おそらく他のCMSでも画面プレビュー機能はあると思いますが、私が知らないのと、探して比較しようとは思いません。<br>そう思うぐらいMicroCMSで満足しているのです。<br></p><h1 id=\"hfe212d43ad\">外部CMSを使いつつ、速度を改善する</h1><p>さて、本題です。<br>概要をざっくり言えば、</p><ul><li>Webフォントを諦める</li><li>画像はGatsbyJSと同じWebサーバーに置く</li><li>画像は.webp形式に変換する</li><li>GatsbyJSのプラグイン拡張だけ使う</li></ul><p>です。<br>一つずつ解説していきます。</p><h2 id=\"h3a2d3a6058\">Webフォントを諦める</h2><p>Webフォントという表現をすると、「サーバーに置けばよくね？」みたいな話を始める人もいますが、そういうい問題ではありません。<br>まずはゆっくり読み進めてみてください。<br><br>このブログでは、遅延読み込みを採用しているのでレイアウト崩れは起こりますが使えないわけではありません。<br>とはいえ、読み込み自体が遅いという問題に目を背けただけなので本質的な解決には至りません。<br>デザイナーズサイトでもない限り、フォントにこだわりすぎるのはよくありません。<br>色々試行錯誤して納得のデザインを見つけた頃には、速度チェッカーに掛けて鈍足だった、なんて事になると目も当てられません。<br>そもそも、フォントはすべての文字に対応しているわけではありませんので、内容によっては漢字がダメ、英数字がダメ、日本語がダメなど使用上の注意点もあります。<br>凝った表現を取り入れて差別化したい気持ちは（このブログでWebフォントを採用しているので）非常によく分かりますが、知識がない状態で実践するのは危険すぎる領域です。<br>サイトが遅いと思ったらスクリプトよりフォントを疑いましょう。</p><h2 id=\"h821d735fab\">画像を次世代の規格（私はwebpを選択）形式にする</h2><p>これはチェッカーに掛けて初めて知りました。<br>webp以外にも似たようなアプローチをしているものとして、JPG2000とかJPEG-XRとか色々な規格がありますので、どれが良いかは比較しないとなんとも言えませんが、手元の画像を変換した感じではどれも対して違いが分かりませんでした。<br>MicroCMSにサイズを最適化した状態のwebpを保存しておき、GatsbyJSで再度変換して全ブラウザで表示できるようにしていますが、ぶっちゃけこれをやる意味ある？ぐらいに思っています。<br>理屈的にはビルド時にやった方が表示が最適化されているらしいです（タグが変わったのは分かりましたが、具体的にどう良くなったか説明できないので「らしい」としました）が、場合によっては容量が増えたりしているのでこの辺りはまだ考えた方が良さそうです。<br>Gatsbyが公式で次世代規格に対応できるようなら検討の余地はあります。<br>なお、MicroCMSは対応しています。この記事の画像もwebpですがGatsbyで変換してjpgやらpngになっていますのでブラウザから確認できませんね…。<br></p><h2 id=\"h4f7172e4ff\">GatsbyJSのプラグインを使う</h2><p>GatsbyはReactがベースなのでReactで使えるものはGatsbyでも使えるんですが、使えるのと使いやすいのはまた別の話です。<br>使いやすいからいいケースもあれば、使いやすくても最適ではない事もあります。<br>ひどいときには「動くけど…う〜ん」みたいなものもありました。<br>GatsbyやReactプラグインのバージョンが上がったら互換性がなくなる、なんてケースもなくはないだろうなので、しっかりと公式サポート（動作検証的な意味で）されているものを使ったほうが安心です。<br>Reactプレーンで完全に独立しているならまた話は変わりますが、どちらにせよ判断がややこしくなるケースが想定されるなら注意するしかないです。<br><br>なお、プラグインを入れすぎて重くならないか検証したのですが、私の触った感じだとプラグインのせいで重くなるということはなかったです。<br>公式でも遅かったものだと、Google Adsenseのようにクライアントサイドのスクリプトを実行している、という事がない限りは気にしなくて良いと思います。</p><h1 id=\"h4d9fb6fdd3\">GatsbyJSで作ったサイトブログをいつまでも爆速で保つために</h1><p>フォントや画像を最適化しつづける限りは大丈夫だと考えてよさそうです。<br>プラグインやスクリプトのダイエットも必要ないでしょう。<br>最初のうちは良かったけど使い続けていくうちに重くなる、というケースにはページネーションなどで負荷を分割する方法が考えられます。<br>サイト内検索もアルゴリズム次第では高速化できるはずです。<br>レコメンド機能も品質に拘らなければ実装はシンプルにできます。<br>要は使い方の問題と思って良いでしょう。<br>サイトの保守契約が必要なケースは少ないんじゃないでしょうか。<br>年に一回、長くて一週間程度でメンテナンスの相談時間を都合する事も可能ですので、静的サイトを検討中もしくは運用中の方の相談に対応できます。<br>個人でも歓迎しますので、お気軽にLINEで友達登録＋メッセージを送ってください。</p>"},"tags":["ブログについて","GatsbyJS"],"description":"Gatsbyに入門して一週間で出来たサイトですが、なかなかサマになったなぁ、と自己満足してます。クオリティやアプローチはまだまだレガシーなんですが、サイトのタイトルの通り「インターネット老人おじさん」としているので、あんまりモダンなレイアウ...","door":{"url":"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/%E3%82%84%E3%82%8A%E3%81%9F%E3%81%84%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B7%E3%82%99.png"},"prev":null,"next":null,"updatedAt":"2021年01月16日 17時12分16秒","publishedAt":"2021年01月16日 17時12分16秒"},"prev":{"mainId":"techinfo","title":"今更注意ですが、人を選ぶウェブサイトです。閲覧時はブラウザをご確認ください。","childConvertHtml":{"convertedHtml":"<p>今更ですが、このサイトはChromeでの閲覧を推奨しています。<br>IEとかFirefox、Safariは動作確認すらしてないです。<br>スマートフォンとかiPhoneは触ってすらいないです。<br>そのくせ、コメントはLINE使ってね、とか行ってるので相当アレですね (^^;<br><br>WindowsとMacで開発してるので対応しようと思えばできるけど、楽しくない部分なのでやりたくない、というのが本音です。<br>問題が見つかったら都度対処していますが、自ら積極的にデバッグ・UIテストはやっていないのであなたの協力が必要不可欠です。<br></p><h1 id=\"hef2de40508\">既知の問題</h1><p>たぶん困らないのは放置（仕様）します。</p><ul><li>ロードが重い<ul><li>このサイトはCDNというキャッシュの仕組みをフル活用しています。</li><li>一度開くと次のページは快適に表示できます。</li></ul></li><li>文字が一瞬だけおかしくなった<ul><li>Webフォントを採用しているため、フォントが適用されるまではお使いの端末の設定に準拠したフォントを代替で表示させています。これは仕様です。</li></ul></li><li>リンク切れがある<ul><li>おそらくアフィリエイトコードが古くなっているためです。これは直しますので教えてほしいです。</li><li>心ばかりのお礼をしたいです。</li></ul></li><li>見づらい<ul><li>それはすみませんでした。レイアウトデザインに関しては、エンジニアのくせにプログラミング以上に時間を掛けまくっているぐらい拘って試行錯誤しているので、見づらい部分のコメントがめっちゃほしいです。なんなら相談させてください。</li></ul></li><li>使い方が分からない<ul><li>それはすみませんでした。昔作ったブログみたいに、サイトをオープンなデータベースにしたいと考えているので、分からないポイントを教えてもらえると、わかりにくかった部分の補足や追加ができて助かります。コメントください。</li></ul></li></ul><p><br>このサイトはGatsbyJS + microCMS + Netlifyで作ってますので、Gatsbyにできない事は私にもできません。<br>ボディケアとかフェイスケアは保証対象外ですが、ブログサイト運営で困った人がGatsbyを使うと使いやすいし爆速だし、で気分がぶっ飛びます（便乗）<br><br>なお、コメントフォームは作ってないので、LINEで公式アカウントを友達に追加してメッセージ送ってください。<br>そしたら私か、同じく記事を書いている妻か、成長した子供が応えてくれます。きっと。<br>個人的には、赤ちゃんの体力を大量消費させて一緒にゆっくり眠れる方法が知りたいです。</p>"},"tags":["ブログについて"],"description":"今更ですが、このサイトはChromeでの閲覧を推奨しています。IEとかFirefox、Safariは動作確認すらしてないです。スマートフォンとかiPhoneは触ってすらいないです。そのくせ、コメントはLINE使ってね、とか行ってるので相当ア...","door":null,"prev":null,"next":null,"updatedAt":"2021年01月16日 12時40分14秒","publishedAt":"2021年01月16日 09時44分68秒"},"next":{"mainId":"shortcut_howtouse","title":"使い方","childConvertHtml":{"convertedHtml":"<p>記事一覧ページで使いたいサービスを探してリンクをクリックするだけです。<br>Microsoft AzureとかGoogle Cloud PlatformやらAmazon ECばっかりなんですが、どれがどこにあるか探すのもしんどいので、ブックマーク的に使えるようにしました。<br>類似したサービスのレコメンドとか「これがあると便利だよな」的なものは思いついた順に完全手動で追加しています。<br><br>記事インデックスは<br><code>[サービス名] 概要 (ページタイトル)</code>としています。<br>最終更新日以降にサービスのバージョンアップなどで構成が変わる場合、リンク切れを起こす事がありますので、発見した際はLINEとかで教えてくれたら嬉しいです。</p>"},"tags":["ブログについて"],"description":"記事一覧ページで使いたいサービスを探してリンクをクリックするだけです。Microsoft AzureとかGoogle Cloud PlatformやらAmazon ECばっかりなんですが、どれがどこにあるか探すのもしんどいので、ブックマーク...","door":null,"prev":null,"next":null,"updatedAt":"2021年01月17日 04時55分74秒","publishedAt":"2021年01月17日 04時47分94秒"},"site":{"title":"インターネット老人おぢさん","siteUrl":"https://speedtest-netlify.netlify.app"}}},"staticQueryHashes":["3156519155","370162261"]}