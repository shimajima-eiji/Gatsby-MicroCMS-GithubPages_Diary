{"componentChunkName":"component---src-templates-blog-post-js","path":"/autobuild","result":{"pageContext":{"post":{"mainId":"autobuild","title":"MicroCMSを使ったJAMStackなサイトで記事を書くたびに自動更新させたいならCIツールを使おう！（GithubAction編）","childConvertHtml":{"convertedHtml":"<h1 id=\"h3301096c4c\">JAMStackなサイトはWordPressの恩恵をすべて捨てるという選択</h1><p>前回の記事まで爆速サイトについて言及しましたが、改めてJAMStackなサイトを作る事とは、動的サイトの恩恵を捨てるという決断である事を再度意識しましょう。<br>たとえば、</p><ul><li>記事を書いたら自動的にアップロードされる</li><li>ブログ内検索ができる</li><li>前のページ、次のページなどナビゲーションリンク</li><li>記事のタイトルとページタイトルを一致させる</li></ul><p>といったケースが考えられます。<br>アフィリエイターにとっては一番最後など致命的以外の何物でもないです。<br>その他細かいものは多くありますが、インパクトの大きいものはこの辺りでしょうか。</p><h2 id=\"h32f741980e\">復習：内部マークダウンと外部CMS</h2><p>内部マークダウンはいわゆるMarkdownファイルです。外部CMSは今回の場合、MicroCMSを指します。<br>MicroCMSについてはお話した通りですが、ここではGithubのようなWebサービスを使うメリットに注目しましょう。<br>MicroCMSのポイントは</p><ul><li>どこからでも</li><li>PCでもスマホでも</li><li>記事を書いたら即反映</li></ul><p>です。<br>実はこの要件を満たすだけなら、Githubにさえ繋げれば記事を更新できます。<br>かつ、MicroCMSと違うのは、<strong>GatsbyJSのプラグインをフルスペック</strong>に使えるということです。<br>前回の記事で「MicroCMSを使いたい理由に</p><ul><li>画面プレビューができる<ul><li>ビルドをしなくても記事を確認できる</li></ul></li><li>どこからでも記事が書ける（重複ですね）</li></ul><p>を上げていました。<br>そして、デメリットとして<code>gatsby-transform-remark</code> が使えない事を上げています。<br>gatsby-transform-remarkはマークダウンを強力にサポートするプラグインで、Gatsbyの良さの半分はこれのおかげだと言ってもいいです。<br>MicroCMS推しの私ですら羨望の眼差しで見ています。<br><br>前回ウェブフォントが遅いという話をしましたが、この問題も解決するでしょう。<br>本当の意味で速度を追求するなら、ベストはホスティングサービス議論よりデータソースをローカルに持たせて制御する以上の事はないですが、マークダウンは癖が強いのでエンジニアやライター以外にはとっつきにくい印象を与えてしまうでしょう。<br>MicroCMSではリッチテキストエディタがあるので、従来のブログライターにも扱いやすいというメリットがあります（私はマークダウンで変換しているので特にありません…）<br>Githubと言い続けていますが、GitLabでも同じことが出来ます。</p><h2 id=\"hcad30e4a70\">記事を書いても更新されない</h2><p>当たり前ですが、JAMStack構成では記事を書いても即反映されません。<br>動的にページが生成されるWordPressと違って、静的なページは新しいページを自分で作る必要がある、という事です。<br>つまり、記事を書いたら再度ビルドする必要があります。<br><br>とはいえ、記事を更新するたびにビルドをするのは面倒です。<br>ビルドを自動化して最新のページを反映させるための仕組みを作るのがCIツールの存在です。</p><h3 id=\"h9ff6a85ae5\">CIツールとは</h3><p>Continuous Integration：継続的インテグレーションと呼ぶ事が多いですが、ここではGithubにpushしたり記事を更新したら自動でビルドしてくれるステキな仕組み、という認識で良いです。<br>CIツールも色々ありますが、今回はGithubActionを使います。</p><h2 id=\"h4019f5ecd1\">GithubActionを使う</h2><p><a href=\"https://docs.github.com/ja/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions\" target=\"_blank\" rel=\"noopener noreferrer\">公式の解説サイト</a> で全部書いているんですが、情報が多すぎるので必要なものだけ抽出します。<br>Gatsbyなどで作ったプロジェクトのルートディレクトリで<code>.github/workflows/○○.yml</code>  でファイルを作ります。<br>ファイル名は何でも良いです。<br>これがGithubActionで実行されるワークフローです。<br><a href=\"https://github.com/shimajima-eiji/Gatsby-MicroCMS-Firebase_Diary/blob/main/.github/workflows/firebase-hosting-merge.yml\" target=\"_blank\" rel=\"noopener noreferrer\">全文</a><br>ここではピンポイントに解説します。</p><h3 id=\"h12a8b44390\">動作条件を指定する：ON句</h3><pre><code class=\"hljs\"><span class=\"hljs-built_in\">name</span>: Deploy <span class=\"hljs-keyword\">to</span> Firebase Hosting <span class=\"hljs-keyword\">on</span> merge\n\t<span class=\"hljs-keyword\">on</span>:\n\t  push:\n\t    branches:\n\t      - main\n\t  repository_dispatch:\n          - types: [MicroCMS_update]</code></pre><p><br></p><ul><li>pushをトリガーにするケース<ul><li>サイトレイアウトを変更した際に動いてほしい</li><li>mainブランチをターゲット</li></ul></li><li>MicroCMSをトリガーにするケース<ul><li>記事更新時にビルドしたい</li><li><span style=\"color:#cf3e51\">MicroCMS_update(任意)のタイプを実行</span></li></ul></li></ul><p>ここはMicroCMSの仕様です。<br><a href=\"https://microcms.io/blog/webhook-for-github-actions/\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub ActionsへのWebhook通知に対応しました（MicroCMS公式）</a></p><h3 id=\"h66d1bed60b\">jobs句</h3><pre><code class=\"hljs\"><span class=\"hljs-attribute\">jobs</span>:\n  (name):\n    <span class=\"hljs-attribute\">runs-on</span>: ubuntu-latest\n    <span class=\"hljs-attribute\">steps</span>:\n    - <span class=\"hljs-attribute\">uses</span>: actions/checkout<span class=\"hljs-variable\">@v2</span>\n    - <span class=\"hljs-attribute\">uses</span>: actions/setup-node<span class=\"hljs-variable\">@v1</span>\n    - <span class=\"hljs-attribute\">run</span>: | \n        yarn\n        yarn build\n    - <span class=\"hljs-attribute\">uses</span>: preceiris/actions-gh-pages<span class=\"hljs-variable\">@v3</span>  # Github Pagesで表示させる\n    </code></pre><p>ジョブ名以下に処理体系をひとかたまりでまとめています。</p><ul><li>runs-on: 実行するイメージ</li><li>steps: <ul><li>uses: Githubが公開するアクション。<ul><li>actions/checkoutでこのリポジトリをチェックアウト</li><li>actions/setup-nodeやpeaceiris/actions-gh-pagesもひとまとめにしたコマンド群</li></ul></li><li>run: 実際に実行するコマンド。packages.jsonをnode_modulesを入れるためにnpm/yarn</li></ul></li></ul><p>こう書くと難しいので、</p><pre><code class=\"hljs\"><span class=\"hljs-meta\"># uses: git clone -b (このリポジトリ)</span>\n<span class=\"hljs-meta\"># uses: npmなりyarnをインストール</span>\nyarn  # ここでGatsby-cliが入る\nyarn build  # gatsby buildが呼ばれるはず\n<span class=\"hljs-meta\"># uses: cd public &amp;&amp; git push -b gh-pages</span></code></pre><p><br>runは明示的にコマンドを、usesはコマンドをGithubがいい感じにやってくれるものという認識でいいです。<br>今回は同じ動作を複数の条件で実施したいのでファイル一つで完了できますが、異なる動作をさせる場合は条件ごとにymlファイルを作成しましょう。<br>このように、今回のようにGithubActionのワークフローはymlファイル一つで完結できます。<br><br>動作確認をする場合は、pushを実施するかMicroCMS\bで記事を書けば良いです。<br>なお、MicroCMSのWebhookを実行する場合はGithubトークンを事前に設定しておきましょう。</p><h1 id=\"h222e49d2c8\">復習</h1><p>静的サイトで爆速かつ快適な運営をするためには、</p><ul><li>Javascript: React</li><li>API</li><li>Markup: CMS</li><li>Git<ul><li>Github</li></ul></li><li>CI: GithubAction（今回）</li><li>ホスティングサービス</li></ul><p>の知識が求められます。<br>SEOはもちろんのこと、SPAやPWAはまた別の知識ですが、将来的には必要になります。</p>"},"tags":["GatsbyJS"],"description":"JAMStackなサイトはWordPressの恩恵をすべて捨てるという選択前回の記事まで爆速サイトについて言及しましたが、改めてJAMStackなサイトを作る事とは、動的サイトの恩恵を捨てるという決断である事を再度意識しましょう。たとえば、...","door":null,"prev":"compire_hosting-services","next":null,"updatedAt":"2021年01月20日 05時32分05秒","publishedAt":"2021年01月20日 05時32分05秒"},"prev":{"mainId":"compire_hosting-services","title":"ホスティングサービスはどこが一番いいの？ フロントエンドQA-PMがNetlify, GithubPages, Firebaseを評価","childConvertHtml":{"convertedHtml":"<p>相変わらず自分の肩書がキモい（死語）事になりますね…<br>プログラマミング業界のマルチタレント、と言えば意図は伝わりそうな気がしました。<br>（厳密に言えば違います）<br>システムの専門家だけど、特定の言語や専門分野としてプログラマーをやっているのではなく、システムのなンでも屋です、としか表現できないのが悩みです。<br><br>さて、今日は何でもやります、のうち速度計測の話を。<br>フロントエンドエンジニアが好きな（いずれ壁にぶち当たるであろう）言葉ですね。<br>JAMStackなブログを作ろうと思っている人は必ず一度は悩むホスティングサーバーをどこにするか問題について、私なりに取り組んだ結果をお話します。<br>この記録は執筆時点のものですので、実際に使われる時には結果が変わっている事が考えられます。</p><h1 id=\"hcb9dacb773\">結論</h1><p>敢えて選ぶとしたらNetlify？<br>ですが、慣れたサービスでいいと思います。</p><h2 id=\"h3e39251a98\">ソースファイル</h2><ul><li><a href=\"[object Object]\">Firebase</a></li><li><a href=\"Gatsby-MicroCMS-GithubPages_Diary\">Github Pages</a></li><li><a href=\"Gatsby-Operation-Nomuraya-Diary\">Netlify</a></li></ul><h2 id=\"h2fe8a1d12a\">速度比較</h2><p><picture><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=117&amp;h=120&amp;fm=webp 117w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=234&amp;h=240&amp;fm=webp 234w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=469&amp;h=480&amp;fm=webp 469w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=938&amp;h=960&amp;fm=webp 938w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=1876&amp;h=1920&amp;fm=webp 1876w\" type=\"image/webp\"><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=117&amp;h=120 117w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=234&amp;h=240 234w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=469&amp;h=480 469w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=938&amp;h=960 938w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=1876&amp;h=1920 1876w\"><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp\" alt=\"\" srcset=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=117&amp;h=120 117w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=234&amp;h=240 234w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=469&amp;h=480 469w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=938&amp;h=960 938w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Firebase.webp?w=1876&amp;h=1920 1876w\" sizes=\"80vw\" loading=\"lazy\"></picture><picture><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=110&amp;h=120&amp;fm=webp 110w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=220&amp;h=240&amp;fm=webp 220w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=440&amp;h=480&amp;fm=webp 440w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=880&amp;h=960&amp;fm=webp 880w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=1760&amp;h=1920&amp;fm=webp 1760w\" type=\"image/webp\"><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=110&amp;h=120 110w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=220&amp;h=240 220w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=440&amp;h=480 440w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=880&amp;h=960 880w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=1760&amp;h=1920 1760w\"><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp\" alt=\"\" srcset=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=110&amp;h=120 110w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=220&amp;h=240 220w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=440&amp;h=480 440w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=880&amp;h=960 880w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/GithubPages.webp?w=1760&amp;h=1920 1760w\" sizes=\"80vw\" loading=\"lazy\"></picture><picture><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=133&amp;h=120&amp;fm=webp 133w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=267&amp;h=240&amp;fm=webp 267w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=535&amp;h=480&amp;fm=webp 535w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=1070&amp;h=960&amp;fm=webp 1070w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=2140&amp;h=1920&amp;fm=webp 2140w\" type=\"image/webp\"><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=133&amp;h=120 133w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=267&amp;h=240 267w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=535&amp;h=480 535w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=1070&amp;h=960 1070w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=2140&amp;h=1920 2140w\"><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp\" alt=\"\" srcset=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=133&amp;h=120 133w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=267&amp;h=240 267w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=535&amp;h=480 535w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=1070&amp;h=960 1070w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/Netlify.webp?w=2140&amp;h=1920 2140w\" sizes=\"80vw\" loading=\"lazy\"></picture><br>Netlifyは遅いとかFirebaseが圧倒的だとか言われますが、実測値では大した違いはないです。<br>イエローゾーン内で65±15を行ったり来たりしてるので、数字はガチャ運です。<br>せっかくだから頑張れるぐらい高い数値を狙って３つ全部で同じ数値になるようガチャを引いたら案外簡単にできたのでパシャりました。</p><h2 id=\"h5fe5785d53\">敢えてNetlifyを推す理由</h2><p>MicroCMSでWebhookを設定する時に明示的に指定ができるからです。<br><picture><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=160&amp;h=68&amp;fm=webp 160w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=320&amp;h=137&amp;fm=webp 320w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=640&amp;h=275&amp;fm=webp 640w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=1280&amp;h=550&amp;fm=webp 1280w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=2560&amp;h=1100&amp;fm=webp 2560w\" type=\"image/webp\"><source srcSet=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=160&amp;h=68 160w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=320&amp;h=137 320w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=640&amp;h=275 640w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=1280&amp;h=550 1280w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=2560&amp;h=1100 2560w\"><img src=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp\" alt=\"\" srcset=\"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=160&amp;h=68 160w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=320&amp;h=137 320w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=640&amp;h=275 640w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=1280&amp;h=550 1280w, https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/MicroCMS%20Webhook%E8%A8%AD%E5%AE%9A.webp?w=2560&amp;h=1100 2560w\" sizes=\"80vw\" loading=\"lazy\"></picture><br>Webhookを指定することで、記事を更新するたびに新着記事を各ホスティングサービスに通知する事ができます。<br>これがあると、WordPressと同じような感覚でブログの更新ができるようになる（当然、更新も表示も爆速を維持したまま）ので、<br>「静的サイト？WordPress？何が違うの？」みたいな状況にできるわけです。とても素晴らしい！<br>ここを見ている人でJAMStackが分からない人なんていないと思って話してますが、要はWordPressみたいな動的サイトでやってくれてたアレコレを静的サイトでも同じような感覚で使うのは結構骨が折れるものです。<br>裏で色々と頑張ってくれているサービスに感謝しましょう。<br><br>IT人事・採用担当さんに向けて意訳すると「ReactフレームワークをAPI連携して出来たサイトをGithubにCIツール使ってWordPressよりも早くて使いやすいアプリ作りました」と言えるようになります。<br>脱・メルカリクローンではなく、メルカリクローンをJAMStackで作れば、今なら評価も高いんじゃないでしょうか？<br>私の感覚ですが、データベースのメンテナンスコストも考えるとAPIを叩いて取ってきたデータをいい感じに使えるようにサービスを構築する方がモダンな気がします。<br>インターネット老人おじさんなのに若者アピールに余念がないです。褒めてください。</p><h2 id=\"h893ded46e8\">GithubPagesのいいところ</h2><p>普段Gitを使い慣れている人にとって最も教育コストが低い事が挙げられます。<br><br>ローカルで<code>gatsby build</code> してpublicを公開用リポジトリにpushすればページを公開できるので、難しそうな事は考えなくていいのが強みです。<br>GithubPagesをdocsディレクトリに指定してpublic-&gt;docsにリネームして丸ごとアップすればソース管理もできます。<br>ただし、無料プランだとプライベートリポジトリでGithubPagesを公開できないので、公開用のリポジトリとソース管理用のリポジトリを分ける等の工夫が必要です。<br>たとえば、developリポジトリにソースコードをおいて、<code>gatsby build</code>で生成したpublicディレクトをopenリポジトリに置く事でAPIキーを秘匿できるのでセキュリティ面でも安心です。</p><h2 id=\"h7ecff0c163\">Firebaseのいいところ</h2><p>GithubPagesのようにリポジトリで分けず、サービスで分けたのがFirebaseやNetlifyのイメージです。<br>FirebaseはGoogleが作った、と一言だけ言えばアフィリエイターなら全員納得してくれますよね？<br>他のサービスよりGoogleアナリティクスやGoogleアドセンスといった、めちゃくちゃ重いスクリプトが最も最適化された状態で使用する事ができるのです。<br>元々はホスティングサービスではなくBaasとして使えるサービスだったので、その機能の一つにホスティングがある、という位置づけです。<br>今回使ったのもFirebaseホスティングだけですが、Firebaseは他にも機能が豊富にあるのでエンジニアとしてスキルアップしたいなら使ってみるのも悪くないでしょう。</p><h2 id=\"h4a88b00160\">技術要件</h2><p>なるほど、こりゃいい！となってくる頃だと思うので、就職活動のポートフォリオにしようと考えもよぎるかと思いますので、この辺りで一応心を折っておく事にします。<br>今回の要件を実装するために必要なエンジニアリングスキルは、</p><ul><li>サイト作成のためのReactスキル：Reactである必要はありませんが、今回はReactを採用しています<ul><li>フロントエンド、特に表示制御に集中できます</li><li>バックエンド、今回は<code>Gatsby-config.js</code>  や<code>Gatsby-code.js</code>  辺りが該当します。ここだけで完結できます。</li></ul></li><li>API構築：今回はMicroCMSに丸投げしているので繋ぎの部分とMicroCMSの仕様だけ知っておけばいいです</li><li>ライティングスキル：記事を書く、というのは実は結構度胸が要ります。発信しようと思っている人が多いので軽視されがちですが、書けない人は本当に書けないです。</li><li>Githubを使うためのGitコマンド：プロジェクトによってはGitの運用プラクティスも求められます</li><li>静的サイトの使い方：GithubPagesとかFirebaseとかNetlifyなど、今回のメインテーマです</li><li>ページを更新したら画面に反映する仕組み：これがビルドです。次のページでより詳細に解説します。</li></ul><p>ざっくりいうと</p><ul><li>J: Javascript／ReactやらVueやら</li><li>A: API／</li><li>M: Markup</li></ul><p>Stackは一語で「つながり・積み重ね」です。</p><h2 id=\"h443c4747fc\">記事を更新しても反映されない</h2><p>次の問題です。<br>MicroCMSを更新してもサイトに新しい記事は反映されません。<br>これを反映させるためにビルドを行う必要があります。<br>手動で行うなら、</p><ol><li>記事を更新</li><li><code>gatsby build</code> </li><li>デプロイコマンドを実施<ol><li>（GithubPagesのみ）publicディレクトリをpushする</li></ol></li></ol><p>とはいえ、記事を更新するたびにビルドしてデプロイするのは面倒です。<br>これを簡略化・自動化する仕組みがCMS側に必要です。<br>GithubPagesの場合も同様です。<br></p>"},"tags":["GatsbyJS","考察"],"description":"相変わらず自分の肩書がキモい（死語）事になりますね…プログラマミング業界のマルチタレント、と言えば意図は伝わりそうな気がしました。（厳密に言えば違います）システムの専門家だけど、特定の言語や専門分野としてプログラマーをやっているのではなく、...","door":{"url":"https://images.microcms-assets.io/protected/ap-northeast-1:45600192-d42c-45d5-a8f8-dad14f377d3c/service/diary/media/%E3%82%AB%E3%82%99%E3%83%81%E3%83%A3.webp"},"prev":"complate_v1","next":"autobuild","updatedAt":"2021年01月20日 03時06分68秒","publishedAt":"2021年01月20日 03時06分68秒"},"next":{"mainId":"diary-greeting","title":"Gatsby+MicroCMS+NetlifyでJAMStackなブログを運営する","childConvertHtml":{"convertedHtml":"<p>どうもです、のむらやです。<br>タイトルのモチベーションで開設して２日で出来ました。<br>実稼働で15時間ぐらい。集中してやればここまで出来るんだなぁ、と感心しているところです。<br>どちらかというと、記事を書くほうがつらい。ネタはあるんだけど何から書こうか悩んでいます。<br>そんな状態で書いているのでこの記事が一番支離滅裂かもしれない。<br>予めお詫びします。<br></p><h2 id=\"hf664f57031\">ブログ遍歴</h2><p>以前までJekyllとかadiaryとか、サービスだとはてブやらnoteやらQiitaなど、もちろんWordPressとかも使っていたんですが、どれもしっくり来なくて途中でポイッとやってきた経緯があります。<br>格安サーバーを求めて稼働したら、案の定サービスが終了して家なき子になってしまったんですよね。<br>そこそこドメインパワーもあったので使おうと思ったんですが、お名前.comさんは一年経つとドメイン使用量がべらぼうに上がることも多いんで、基本的に一年で捨てて新しいドメインを取る、という事をやっていくと「最初から取らなかったほうが良くね？」という事に気付いてしまうのです。<br>それで現状があるので、完全無料でエンジニアライクな環境でノウハウ蓄積したいなと思いまして、JAMstackにたどり着きました。<br></p><h2 id=\"h80cc118e47\">私のことを少しだけ</h2><p>別の記事で細かい話を書く予定ですが、元々はアフィリエイトもやっている現役エンジニアのIT講師という結構珍しい仕事をしているので、色々な社会のしがらみに縛られずに話せる場所がなかなか限られています。<br>従って、本当に有益な情報（流出すると商売敵など、不特定の業者が困る情報）を発信する場合は予め公開範囲を制限させていただく事になります。<br>最初のうちは小さめに公開範囲を制限しつつ、数が集まれば記事一本全体を制限しつつ、溜まっていけば書籍化（自費）も考えています。<br>資金目的ではないのでクラウドファンディングは見送りましたが、サブスクリプションは興味がありますね。金額とかじゃなくて「お金出してでも買うよ」という人がいてくれると、多少冒険できる心強さがあります。<br>そういう人に向けて書くお話です。コロナ禍の複業に挑戦される方向けに「エンジニアという働き方」「講師という働き方」について語れるのではないかと思っています。<br></p><h2 id=\"hf5dbabf67d\">読者に期待すること</h2><p>Qiita式とかアメブロ式が嫌いなので積極的に広告は出しませんが、メディアには露出しようと思っています。<br>youtubeを始めとした動画配信を頑張ってみたり、動画で話せないやべー話やブログで言えないからメルマガ（LINEとか）にしようとか、そういう計画をなんとなく考えています。<br>話せる内容は全部無料です。お酒飲んで酔った時はここだけの話です。<br><br>そういう「昭和のおっさん感」が伝わる人を対象に書いていくつもりです。<br>若者だからダメとかじゃなく、インターネット老人のおっさんだってまだまだネット社会で頑張っていくぞという事が言いたい。<br>とはいえ、流行りものには疎いので懐古主義にはなります。<br></p><h2 id=\"h1bc47dcf5d\">収益について</h2><p>基本的には広告費と商品紹介、公開制限を掛けている有料記事で考えています。<br>皆さんから（広告費含め）頂いた金額は**誠意として**しっかり公開していきたいですし、何に使ったかもお伝えします。<br>自分の生活費を目的にブログをやるとガッカリしますよ。<br>これは一時期月40万稼いでた事があるから力説しますが、生活のためにブログをやると記事がつまらなくなるんです。<br><br>今度こそ、そうなりたくないので収益は読んでくれているあなたと一緒に、あるいはあなたが楽しめて私も楽しめる「何か」を考えて使いたいなと思っています。<br><br><br>よくあるアフィリエイトブログの「いかがでしょうか」というフレーズが嫌いな私ですが、皆さんのお考えは聞きたいです。<br>次回、あるいは近日どこかでこのブログの使い方やお願いなんかを考えてみようと思います。</p>"},"tags":["ブログについて"],"description":"どうもです、のむらやです。タイトルのモチベーションで開設して２日で出来ました。実稼働で15時間ぐらい。集中してやればここまで出来るんだなぁ、と感心しているところです。どちらかというと、記事を書くほうがつらい。ネタはあるんだけど何から書こうか...","door":null,"prev":null,"next":null,"updatedAt":"2021年01月16日 03時55分35秒","publishedAt":"2021年01月10日 04時54分11秒"},"site":{"title":"インターネット老人おぢさん","siteUrl":"https://speedtest-netlify.netlify.app"}}},"staticQueryHashes":["3156519155","370162261"]}